{
  "cndi-config": {
    "prompts": [
      {
        "name": "kind",
        "type": "Select",
        "message": "Please select the cloud provider you want to use:",
        "options": [
          { "name": "AWS", "value": "aws" },
          { "name": "GCP", "value": "gcp" },
          { "name": "Azure", "value": "azure" }
        ]
      },
      {
        "name": "argocdDomainName",
        "default": "https://github.com/polyseam/demo-dag-bag",
        "message": "Please enter the domain name you want argocd to be accessible on:",
        "type": "Input"
      },
      {
        "message": "Please enter the email address you want to use for lets encrypt:",
        "default": "admin@example.com",
        "name": "letsEncryptClusterIssuerEmailAddress",
        "type": "Input"
      }
    ],
    "template": {
      "infrastructure": {
        "cndi": {
          "nodes": [
            {
              "name": "x-node",
              "kind": "$.cndi.prompts.kind",
              "role": "leader",
              "volume_size": 128
            },
            {
              "name": "y-node",
              "kind": "$.cndi.prompts.kind",
              "volume_size": 128
            },
            {
              "name": "z-node",
              "kind": "$.cndi.prompts.kind",
              "volume_size": 128
            }
          ]
        }
      },
      "cluster_manifests": {
        "cert-manager-cluster-issuer": {
          "apiVersion": "cert-manager.io/v1",
          "kind": "ClusterIssuer",
          "metadata": {
            "name": "lets-encrypt"
          },
          "spec": {
            "acme": {
              "email": "$.cndi.prompts.letsEncryptClusterIssuerEmailAddress",
              "server": "https://acme-v02.api.letsencrypt.org/directory",
              "privateKeySecretRef": {
                "name": "lets-encrypt-private-key"
              },
              "solvers": [
                {
                  "http01": {
                    "ingress": {
                      "class": "public"
                    }
                  }
                }
              ]
            }
          }
        },
        "argo-ingress": {
          "apiVersion": "networking.k8s.io/v1",
          "kind": "Ingress",
          "metadata": {
            "name": "argocd-server-ingress",
            "namespace": "argocd",
            "annotations": {
              "cert-manager.io/cluster-issuer": "lets-encrypt",
              "kubernetes.io/tls-acme": "true",
              "nginx.ingress.kubernetes.io/ssl-passthrough": "true",
              "nginx.ingress.kubernetes.io/backend-protocol": "HTTPS"
            }
          },
          "spec": {
            "tls": [
              {
                "hosts": ["$.cndi.prompts.argocdDomainName"],
                "secretName": "lets-encrypt-private-key"
              }
            ],
            "rules": [
              {
                "host": "$.cndi.prompts.argocdDomainName",
                "http": {
                  "paths": [
                    {
                      "path": "/",
                      "pathType": "Prefix",
                      "backend": {
                        "service": {
                          "name": "argocd-server",
                          "port": {
                            "name": "https"
                          }
                        }
                      }
                    }
                  ]
                }
              }
            ]
          }
        }
      },
      "applications": {}
    }
  },
  "env": {
    "prompts": []
  },
  "readme": {
    "extend_basic_readme": true
  }
}
